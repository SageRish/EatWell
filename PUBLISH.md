# Publish checklist — EatWell Chrome Extension

This document lists the steps and assets required to publish the EatWell Chrome extension to the Chrome Web Store, and describes how to generate a distributable zip using the included `package-extension.sh` script.

## Quick checklist
- [ ] Confirm tests and lint pass locally: `npm test` and `npm run lint`
- [ ] Build the extension: `npm run build`
- [ ] Run packaging script: `./package-extension.sh` (or via WSL/Git Bash on Windows)
- [ ] Review `artifact/eatwell-chrome-extension.zip` contents
- [ ] Verify `manifest.json` version is incremented
- [ ] Provide a valid Privacy Policy and link (PRIVACY_POLICY.html included in zip)
- [ ] Prepare screenshots (recommended 1280x800 and 440x280) and icons (128, 48, 16 px) in `screenshots/` and `public/icons/`
- [ ] Ensure demo mocks are disabled (see step below)
- [ ] Obtain API keys for any external providers and configure them securely (see step below)
- [ ] Upload the zip to the Chrome Web Store Developer Dashboard and fill store listing
- [ ] Publish and monitor rollout

## Packaging with `package-extension.sh`

The repository includes `package-extension.sh`. It:

- Verifies the `dist/` directory exists (generated by `npm run build`).
- Copies the built files into a temporary packaging directory.
- Includes a privacy policy file (uses `PRIVACY_POLICY.html` if present; converts `PRIVACY.md` if available; otherwise creates a template).
- Collects icons from `public/icons`, `src/assets/icons`, or `icons` and `screenshots/` if present.
- Produces `artifact/eatwell-chrome-extension.zip` ready for upload.

Usage:

```bash
# build first
npm run build
./package-extension.sh
```

On Windows you have two options:

- Run the existing bash script from Git Bash or WSL:

```bash
# build first
npm run build
./package-extension.sh
```

- Or use the native PowerShell packager included in this repo: `package-extension.ps1` (recommended on Windows). This script uses PowerShell's `Compress-Archive` so you don't need a separate `zip` binary. Run it from an elevated or unrestricted session or bypass execution policy for the run:

```powershell
# build first
npm run build
# run in PowerShell (temporarily bypass execution policy)
powershell -NoProfile -ExecutionPolicy Bypass -File .\package-extension.ps1
```

Alternatively, inspect the `artifact/` directory and create a zip by hand (zip the contents of `dist/` plus the privacy policy and images).

## Privacy policy template

Your privacy policy must clearly describe:

- What data the extension accesses and why (ingredients, recipe text, optional remote calls).
- Whether data leaves the user's device and under what conditions (e.g., when external nutrition or summarization APIs are enabled).
- How users can disable remote calls (Privacy Mode) and what that does.
- Contact info and retention/processing details.

The packaging script will create a basic `PRIVACY_POLICY.html` if none exists. Replace it with your final policy before publishing.

### Example short privacy blurb (copy into PRIVACY_POLICY.html)

> EatWell extracts recipe text and ingredient lists from pages you visit to provide nutrition and allergen insights. When Privacy Mode is enabled, no external network requests are made and mock/local providers are used. For remote assistance (nutrition lookups, summarization), external APIs may be called and are governed by their own policies.

## Turning off demo mocks and enabling production providers

Before publishing, you should ensure the extension is not using demo/mock providers. The codebase includes mock providers used for development and privacy tests. To prepare a production build:

1. Set Privacy Mode appropriately
   - If you want the published extension to use real remote providers, ensure `privacyMode` is disabled by default in preferences or configuration. The codebase stores preferences in `src/utils/prefs/storage.ts` and a runtime `privacy` controller in `src/utils/privacy/index.ts`.
   - For a conservative, privacy-first listing, consider leaving Privacy Mode enabled by default and document how users can opt in to remote services.

2. Update provider config
   - Open `src/utils/nutrition/index.ts` or `src/config/nutritionConfig.ts` (or similar config file in your repo) and set the provider to the real provider (e.g., `usda`) rather than `mock`.
   - Verify any other APIs (summarizer, promptFn adapters) are configured to use production endpoints.

3. Remove or disable demo keys
   - Remove any embedded demo API keys or test tokens from the source code.
   - Use runtime configuration (chrome.storage or a secure remote endpoint) to provide API keys where required.

4. Validate runtime behavior
   - Test the extension in a developer install that Privacy Mode is off and confirm remote calls are made and results are correct.

## Obtaining API keys and configuring external services

If your build relies on external APIs (nutrition providers, AI/summarization providers), perform these steps:

1. Create a Google Cloud Project (or the provider's account) and enable the APIs you need.
2. Create credentials (API key, OAuth client, or service account) according to the provider's instructions.
3. Do not commit keys to the repository. Instead:
   - Use the extension's options page to let the user enter their key, stored securely in `chrome.storage`.
   - Or, provide a secure server-side proxy that holds the key and proxies requests (recommended for secret management).
4. Document the required configuration in your store listing and README.

## Store listing assets

- Icons: provide at least 128x128px icon (recommended sizes: 128, 48, 16). Place them in `public/icons/` and ensure `manifest.json` points to the correct paths.
- Screenshots: high-quality screenshots showing the extension UI, Cook mode, alerts. Recommended resolutions: 1280x800 and 440x280.
- Short and long description: keep the short description to one concise sentence (max ~132 characters). The long description can explain features, privacy, and data usage.

### Suggested short description (also included in package):

> EatWell — find allergens, nutrition facts and smart substitutions for recipes using Chrome's AI APIs.

## Publishing steps

1. Sign in to the Chrome Web Store Developer Dashboard: https://chrome.google.com/webstore/developer
2. Create a new item or edit an existing one.
3. Upload `artifact/eatwell-chrome-extension.zip`.
4. Fill in listing details (title, short/long descriptions, screenshots, icon, category, languages).
5. Upload Privacy Policy URL (publicly hosted) and contact details.
6. Choose visibility and rollout settings, then publish.

## Post-publish

- Monitor user feedback and crash reports.
- Keep extension manifest `version` updated for each uploaded zip.
- If you ship remote providers, maintain clear instructions for users to configure API keys and toggle Privacy Mode.

## Troubleshooting

- If the Chrome Web Store rejects the package: ensure `manifest.json` is valid and all files referenced (icons, background scripts) are included in the zip root.
- If remote APIs fail in production, check network permissions in `manifest.json` (host permissions) and ensure user consent is clear.

---

If you'd like, I can also:

- Produce a `package-extension.ps1` PowerShell variant for Windows-native packaging.
- Add a small options page in the extension to let the developer enter API keys at runtime (stored in `chrome.storage`) and a simple toggle to enable/disable demo mocks.
